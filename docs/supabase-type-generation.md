# Supabase Type Generation Guide

This document provides guidance on keeping your TypeScript types in sync with your Supabase database schema.

## Generating TypeScript Types

To generate TypeScript types from your Supabase database schema, use the following command:

```bash
npx supabase gen types typescript --project-id yyqodsrvslheazteialw > src/integrations/supabase/types.ts
```

This command fetches the current database schema from your Supabase project and generates TypeScript type definitions that match your tables, views, and functions.

## When to Regenerate Types

You should regenerate your TypeScript types in the following situations:

1. **After Schema Changes**: Whenever you modify your database schema (adding/removing tables, columns, etc.)
2. **After Migration Deployments**: After running migrations that alter the database structure
3. **Periodically**: As a best practice, regenerate types periodically to ensure they stay in sync

## Periodic Type Generation

### Manual Periodic Updates

Set a regular schedule (e.g., weekly or bi-weekly) to regenerate your types:

```bash
# Add this to your team's recurring tasks
npx supabase gen types typescript --project-id yyqodsrvslheazteialw > src/integrations/supabase/types.ts
```

### Automation Options

#### 1. CI/CD Pipeline Integration

Add type generation to your CI/CD pipeline:

```yaml
# Example GitHub Actions workflow step
- name: Generate Supabase Types
  run: |
    npx supabase gen types typescript --project-id yyqodsrvslheazteialw > src/integrations/supabase/types.ts
    git diff --exit-code || (git config --global user.name 'CI Bot' && git config --global user.email 'ci@example.com' && git add src/integrations/supabase/types.ts && git commit -m "Update Supabase types" && git push)
```

This will:
- Generate the latest types
- Commit and push changes if the types have been updated

#### 2. Pre-commit Hook

Add a pre-commit hook to check if types are up-to-date:

```bash
#!/bin/sh
# .git/hooks/pre-commit or use husky

# Generate types to a temporary file
npx supabase gen types typescript --project-id yyqodsrvslheazteialw > /tmp/supabase-types.ts

# Compare with current types
if ! cmp -s /tmp/supabase-types.ts src/integrations/supabase/types.ts; then
  echo "⚠️ Supabase types are out of date. Run 'npx supabase gen types typescript --project-id yyqodsrvslheazteialw > src/integrations/supabase/types.ts' to update them."
  exit 1
fi
```

#### 3. Scheduled GitHub Action

Create a scheduled GitHub Action to check and update types:

```yaml
name: Update Supabase Types

on:
  schedule:
    - cron: '0 0 * * 1' # Weekly on Monday at midnight

jobs:
  update-types:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install Supabase CLI
        run: npm install -g supabase
        
      - name: Login to Supabase
        run: echo "${{ secrets.SUPABASE_ACCESS_TOKEN }}" | supabase login
        
      - name: Generate Types
        run: |
          npx supabase gen types typescript --project-id yyqodsrvslheazteialw > src/integrations/supabase/types.ts
          
      - name: Create Pull Request if Changed
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: Update Supabase types
          title: Update Supabase TypeScript types
          body: |
            This PR updates the Supabase TypeScript types to match the current database schema.
            
            Auto-generated by the Update Supabase Types workflow.
          branch: update-supabase-types
```

## Best Practices

1. **Version Control**: Always commit the generated types to your repository
2. **Review Changes**: When types change, review the differences to understand schema changes
3. **Type Safety**: Use the generated types consistently throughout your application
4. **Documentation**: Document any custom extensions to the generated types

## Troubleshooting

If you encounter issues with type generation:

1. Ensure you're logged in with `npx supabase login`
2. Verify your project ID with `npx supabase projects list`
3. Check for access permissions to the project
4. Try the `--debug` flag for more information: `npx supabase gen types typescript --project-id yyqodsrvslheazteialw --debug`

## Additional Resources

- [Supabase TypeScript Support Documentation](https://supabase.com/docs/reference/javascript/typescript-support)
- [Supabase CLI Documentation](https://supabase.com/docs/reference/cli)
- [Type-Safe Database Access with Supabase](https://supabase.com/blog/supabase-js-v2)